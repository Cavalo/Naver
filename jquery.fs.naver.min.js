/*
 * Naver Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.0.1
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
(function($) {
	
	var pub = {
		activate: function() {
			$(this).each(function() {
				$(this).addClass("active")
					   .trigger("close.naver");;
			});
		},
		deactivate: function() {
			$(this).each(function() {
				$(this).removeClass("active")
					   .trigger("close.naver");
			});
		}
	};
	
	function _init() {
		return $(this).each(_build);
	}
	
	function _build() {
		var $nav = $(this),
			data = {
				$nav: $nav,
				$wrapper: $nav.find(".naver-wrapper"),
				$container: $nav.find(".naver-container"),
				$handle: $nav.find(".naver-handle")
			};
		
		data.$nav.on("click.naver", ".naver-handle", data, _onClick)
				 .on("open.naver", data, _open)
				 .on("close.naver", data, _close);
	}
	
	function _onClick(e) {
		e.preventDefault();
		e.stopPropagation();
		
		var $target = $(e.currentTarget),
			data = e.data;
		
		$(".naver").not(data.$nav).trigger("close.naver");
		
		if (data.$nav.hasClass("open")) {
			data.$nav.trigger("close.naver");
		} else {
			data.$nav.trigger("open.naver");
		}
	}
	
	function _close(e) {
		var data = e.data;
		data.$wrapper.css({ height: 0 });
		data.$nav.removeClass("open");
		
		if (data.$handle.data("original")) {
			data.$handle.html(data.$handle.data("original"));
		}
	}
	
	function _open(e) {
		var data = e.data;
		data.$wrapper.css({ height: data.$container.outerHeight(true) });
		data.$nav.addClass("open");
		
		if (data.$handle.data("active")) {
			data.$handle.html(data.$handle.data("active"));
		}
	}
	
	$.fn.naver = function(method) {
		if (pub[method]) {
			return pub[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return _init.apply(this, arguments);
		}
		return this;
	};
})(jQuery);